apiVersion: v1
kind: ConfigMap
metadata:
  name: rabbitmq-environment-config
  namespace: rabbitmq
  labels:
    app.kubernetes.io/name: rabbitmq
    app.kubernetes.io/component: environment-config
data:
  # Environment-specific configurations
  # Modify these values based on your environment (dev, staging, prod)
  
  # Development Environment
  dev.conf: |
    # RabbitMQ Development Configuration
    
    # Resource limits for development
    rabbitmq_memory_limit = 1Gi
    rabbitmq_cpu_limit = 500m
    rabbitmq_memory_request = 512Mi
    rabbitmq_cpu_request = 250m
    
    # Storage configuration
    storage_size = 5Gi
    storage_class = rabbitmq-standard-storage
    
    # Replica count
    replica_count = 1
    
    # Performance settings
    vm_memory_high_watermark = 0.6
    heartbeat = 60
    
    # Management settings
    management_load_definitions = /etc/rabbitmq/definitions.json
    management_rate_mode = basic
    
    # Log level
    log_level = info
    
    # Network settings
    cluster_formation.node_cleanup.interval = 30
    cluster_formation.node_cleanup.only_log_warning = true
    
  # Staging Environment
  staging.conf: |
    # RabbitMQ Staging Configuration
    
    # Resource limits for staging
    rabbitmq_memory_limit = 2Gi
    rabbitmq_cpu_limit = 1000m
    rabbitmq_memory_request = 1Gi
    rabbitmq_cpu_request = 500m
    
    # Storage configuration
    storage_size = 10Gi
    storage_class = rabbitmq-standard-storage
    
    # Replica count
    replica_count = 2
    
    # Performance settings
    vm_memory_high_watermark = 0.6
    heartbeat = 60
    
    # Management settings
    management_load_definitions = /etc/rabbitmq/definitions.json
    management_rate_mode = detailed
    
    # Log level
    log_level = warning
    
    # Network settings
    cluster_formation.node_cleanup.interval = 60
    cluster_formation.node_cleanup.only_log_warning = false
    
  # Production Environment
  prod.conf: |
    # RabbitMQ Production Configuration
    
    # Resource limits for production
    rabbitmq_memory_limit = 4Gi
    rabbitmq_cpu_limit = 2000m
    rabbitmq_memory_request = 2Gi
    rabbitmq_cpu_request = 1000m
    
    # Storage configuration
    storage_size = 20Gi
    storage_class = rabbitmq-fast-storage
    
    # Replica count
    replica_count = 3
    
    # Performance settings
    vm_memory_high_watermark = 0.6
    heartbeat = 60
    
    # Management settings
    management_load_definitions = none
    management_rate_mode = detailed
    
    # Log level
    log_level = warning
    
    # Network settings
    cluster_formation.node_cleanup.interval = 60
    cluster_formation.node_cleanup.only_log_warning = false
    
    # High availability settings
    cluster_partition_handling = pause_minority
    queue_master_locator = min-masters
    
  # Custom Resource Definitions for different environments
  dev-cluster.yaml: |
    apiVersion: rabbitmq.com/v1beta1
    kind: RabbitmqCluster
    metadata:
      name: rabbitmq-dev
      namespace: rabbitmq
    spec:
      replicas: 1
      image: rabbitmq:3.12-management
      resources:
        requests:
          cpu: 250m
          memory: 512Mi
        limits:
          cpu: 500m
          memory: 1Gi
      persistence:
        storage: 5Gi
        storageClassName: rabbitmq-standard-storage
      rabbitmq:
        additionalPlugins:
          - rabbitmq_management
          - rabbitmq_prometheus
      service:
        type: ClusterIP
      
  staging-cluster.yaml: |
    apiVersion: rabbitmq.com/v1beta1
    kind: RabbitmqCluster
    metadata:
      name: rabbitmq-staging
      namespace: rabbitmq
    spec:
      replicas: 2
      image: rabbitmq:3.12-management
      resources:
        requests:
          cpu: 500m
          memory: 1Gi
        limits:
          cpu: 1000m
          memory: 2Gi
      persistence:
        storage: 10Gi
        storageClassName: rabbitmq-standard-storage
      rabbitmq:
        additionalPlugins:
          - rabbitmq_management
          - rabbitmq_prometheus
          - rabbitmq_federation
          - rabbitmq_shovel
      service:
        type: ClusterIP
      
  prod-cluster.yaml: |
    apiVersion: rabbitmq.com/v1beta1
    kind: RabbitmqCluster
    metadata:
      name: rabbitmq-prod
      namespace: rabbitmq
    spec:
      replicas: 3
      image: rabbitmq:3.12-management
      resources:
        requests:
          cpu: 1000m
          memory: 2Gi
        limits:
          cpu: 2000m
          memory: 4Gi
      persistence:
        storage: 20Gi
        storageClassName: rabbitmq-fast-storage
      rabbitmq:
        additionalPlugins:
          - rabbitmq_management
          - rabbitmq_prometheus
          - rabbitmq_federation
          - rabbitmq_shovel
          - rabbitmq_mqtt
          - rabbitmq_stomp
      service:
        type: ClusterIP
      
  # Monitoring configurations
  monitoring-dev.yaml: |
    # Development monitoring configuration
    prometheus_scrape_interval = 30s
    prometheus_scrape_timeout = 10s
    alert_rules_enabled = false
    grafana_dashboards_enabled = true
    
  monitoring-staging.yaml: |
    # Staging monitoring configuration
    prometheus_scrape_interval = 15s
    prometheus_scrape_timeout = 10s
    alert_rules_enabled = true
    grafana_dashboards_enabled = true
    
  monitoring-prod.yaml: |
    # Production monitoring configuration
    prometheus_scrape_interval = 10s
    prometheus_scrape_timeout = 5s
    alert_rules_enabled = true
    grafana_dashboards_enabled = true
    
  # Backup configurations
  backup-dev.yaml: |
    # Development backup configuration
    backup_schedule = "0 3 * * *"  # Daily at 3 AM
    backup_retention_days = 7
    backup_storage_size = 10Gi
    
  backup-staging.yaml: |
    # Staging backup configuration
    backup_schedule = "0 2 * * *"  # Daily at 2 AM
    backup_retention_days = 14
    backup_storage_size = 20Gi
    
  backup-prod.yaml: |
    # Production backup configuration
    backup_schedule = "0 1 * * *"  # Daily at 1 AM
    backup_retention_days = 30
    backup_storage_size = 50Gi