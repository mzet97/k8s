apiVersion: v1
kind: ConfigMap
metadata:
  name: redis-config
  namespace: redis
data:
  redis-master.conf: |
    # Configuração Master
    port 6379
    bind 0.0.0.0
    protected-mode no
    
    # Autenticação (senha injetada via variável de ambiente no StatefulSet)
    
    # Persistência
    save 900 1
    save 300 10
    save 60 10000
    appendonly yes
    appendfsync everysec
    dir /data
    
    # Performance
    maxmemory 1gb
    maxmemory-policy allkeys-lru
    tcp-keepalive 300
    timeout 0
    
    # Logs
    loglevel notice
    logfile ""
    
    # TLS Configuration
    tls-port 6380
    port 0
    tls-cert-file /tls/tls.crt
    tls-key-file /tls/tls.key
    tls-ca-cert-file /tls/ca.crt
    tls-protocols "TLSv1.2 TLSv1.3"
  
  redis-replica.conf: |
    # Configuração Replica
    port 6379
    bind 0.0.0.0
    protected-mode no
    
    # Autenticação (senha injetada via variável de ambiente no StatefulSet)
    
    # Replicação
    replicaof redis-master.redis.svc.cluster.local 6380
    replica-read-only yes
    replica-serve-stale-data yes
    replica-priority 100
    
    # Persistência
    save 900 1
    save 300 10
    save 60 10000
    appendonly yes
    appendfsync everysec
    dir /data
    
    # Performance
    maxmemory 1gb
    maxmemory-policy allkeys-lru
    tcp-keepalive 300
    timeout 0
    
    # Logs
    loglevel notice
    logfile ""
    
    # TLS Configuration
    tls-port 6380
    port 0
    tls-cert-file /tls/tls.crt
    tls-key-file /tls/tls.key
    tls-ca-cert-file /tls/ca.crt
    tls-protocols "TLSv1.2 TLSv1.3"
    tls-replication yes
